{% extends "base.html" %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'cards.css' %}">
<link rel="stylesheet" href="{% static 'pag_pacotes.css' %}">
{% endblock %}

{% block content %}

<!-- Banner -->
<div class="banner_ferias" style="position: relative; text-align: center; color: white; margin-bottom: 40px;">
    <img src="/media/pacotes/mapamundo.webp" alt="As melhores f√©rias come√ßam aqui"
         style="width: 100%; height: 570px; object-fit: cover; border-radius: 12px;">
    <h1 style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
               font-size: 3rem; font-weight: bold; text-shadow: 5px 5px 12px rgba(0,0,0,0.9);">
        As melhores f√©rias come√ßam aqui
    </h1>
</div>

<div class="container-fluid mt-4 filtros-pacotes-container">
    <div class="row">
        <!-- üîπ FILTROS -->
        <div class="col-lg-3 filtros-laterais">
            <div class="filtros-box">
                <h5>Filtrar Resultados</h5>
                <form method="get" action="{% url 'pacotes_por_pais' %}">
                    
                    <!-- Pesquisa por pa√≠s -->
            <div class="mb-3">
            <label for="pais" class="form-label">Pa√≠s</label>
            <input type="text" name="pais" id="pais" 
                    class="form-control w-100" 
                    placeholder="Ex: Brasil, √Åfrica, Fran√ßa"
                    value="{{ request.GET.pais|default:'' }}">
            </div>

                    <!-- Pre√ßo m√°ximo -->
                    <label for="preco" class="form-label">Pre√ßo m√°ximo (‚Ç¨)</label>
                    <div class="slider-container mb-3">
                        <input type="range" name="preco" id="preco"
                               class="form-range"
                               min="0"
                               max="{{ preco_maximo|floatformat:0|default:10000 }}"
                               step="1"
                               value="{{ request.GET.preco|default:preco_maximo|floatformat:0 }}"
                               oninput="document.getElementById('valorPreco').textContent = this.value + '‚Ç¨'">
                        <div id="valorPreco" class="slider-value">
                            {{ request.GET.preco|default:preco_maximo|floatformat:0 }}‚Ç¨
                        </div>
                        <div class="d-flex justify-content-between small text-muted">
                            <span>0‚Ç¨</span>
                            <span>{{ preco_maximo|floatformat:0 }}‚Ç¨</span>
                        </div>
                    </div>

                    <!-- M√™s -->
                    <label for="mes" class="form-label">M√™s</label>
                    <select name="mes" id="mes" class="form-select mb-4">
                        <option value="">Todos os meses</option>
                        {% for valor, nome in meses %}
                            <option value="{{ valor }}" {% if request.GET.mes == valor %}selected{% endif %}>
                                {{ nome }}
                            </option>
                        {% endfor %}
                    </select>

                    <!-- Bot√£o -->
                    <button type="submit" class="btn btn-info w-100 text-white">Aplicar Filtros</button>
                </form>
            </div>
        </div>

        <!-- üîπ RESULTADOS -->
        <div class="col-lg-9">
            <div class="container section-pacotes">
                <h2 class="text-center mb-4">Pacotes por Pa√≠s</h2>

                {% if pacotes_por_pais %}
                    {% for pais, pacotes in pacotes_por_pais.items %}
                        <div class="mb-5">
                            <h3 class="mb-3">{{ pais }}</h3>
                            <div class="row g-4">
                                {% include "components/cards_only.html" with pacotes=pacotes %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-center text-muted">Nenhum pacote encontrado.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<!-- script para mudar andar com a bola do pre√ßo de um lado para o outro e poder ver o pre√ßo -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const slider = document.getElementById("preco");
    const valor = document.getElementById("valorPreco");

    if (slider && valor) {
        const atualizarValor = () => {
            const val = parseInt(slider.value);
            valor.textContent = val.toLocaleString("pt-PT") + "‚Ç¨";

            // mover o valor junto com a bolinha (opcional e din√¢mico)
            const percent = (val - slider.min) / (slider.max - slider.min);
            const deslocamento = percent * (slider.offsetWidth - 16);
            valor.style.left = deslocamento + "px";
        };

        slider.addEventListener("input", atualizarValor);
        atualizarValor(); // mostrar ao carregar
    }
});
</script>

{% endblock %}
