{% extends 'baseUser.html' %}
{% load static %}
{% block title %}Feedbacks - Atlas Gateway{% endblock %}
{% block page_title %}Feedbacks{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{% static 'feedbacksUser.css' %}" />
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  rel="stylesheet"
/>
{% endblock %}
{% block content %}
<div class="content-wrapper">
  
  <!-- Mensagens de feedback -->
  {% if messages %}
  <div style="margin-bottom: 20px;">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" style="padding: 15px; margin-bottom: 10px; border-radius: 5px; 
         {% if message.tags == 'success' %}background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724;
         {% elif message.tags == 'error' %}background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24;
         {% elif message.tags == 'warning' %}background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404;
         {% else %}background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460;{% endif %}">
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Formulário de Novo Feedback -->
  <div class="section-title">Deixar um Novo Feedback</div>
  <div class="form-section">
    <form method="POST" action="{% url 'users:feedbacksUser' %}" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-group">
        <label class="form-label">Selecionar Pacote</label>
        <select class="form-input" name="reserva_id" required>
          <option value="">Escolha um pacote...</option>
          {% for compra in compras %}
          <option value="{{ compra.0 }}">
            {{ compra.1 }} ({{ compra.2|date:"d/m/Y" }})
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Classificação</label>
        <div class="rating-stars">
          <input type="radio" id="star5" name="avaliacao" value="5" required />
          <label for="star5" class="star">★</label>

          <input type="radio" id="star4" name="avaliacao" value="4" />
          <label for="star4" class="star">★</label>

          <input type="radio" id="star3" name="avaliacao" value="3" />
          <label for="star3" class="star">★</label>

          <input type="radio" id="star2" name="avaliacao" value="2" />
          <label for="star2" class="star">★</label>

          <input type="radio" id="star1" name="avaliacao" value="1" />
          <label for="star1" class="star">★</label>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Título do Feedback</label>
        <input
          type="text"
          class="form-input"
          name="titulo"
          placeholder="Ex: Experiência fantástica em Barcelona"
          required
        />
      </div>

      <div class="form-group">
        <label class="form-label">Comentário</label>
        <textarea
          class="form-textarea"
          name="comentario"
          placeholder="Partilhe a sua experiência com outros viajantes..."
        ></textarea>
      </div>

      <div style="display: flex; gap: 10px">
        <button type="submit" class="btn_search_utils edit_btn_utils" style="padding: 6px 30px; margin-top: 0;">Enviar Feedback</button>
        <button type="reset" class="btn-secondary">Cancelar</button>
      </div>
    </form>
  </div>

  <!-- Lista de Feedbacks Anteriores -->
  <div class="section-title">Meus Feedbacks Anteriores</div>
  <div class="feedbacks-list">
    {% if feedbacks %} {% for feedback in feedbacks %}
    <div class="feedback-item">
      <div class="feedback-header">
        <div>
          <div class="feedback-title">{{ feedback.titulo }}</div>
          <div class="feedback-date">
            {{ feedback.data_feedback|date:"d \d\e F \d\e Y" }}
          </div>
        </div>
        <div class="feedback-rating">
          {% for i in "12345" %}
            {% if forloop.counter <= feedback.avaliacao %}★{% else %}☆{% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="feedback-package">{{ feedback.pacote_nome }}</div>
      <div class="feedback-text">{{ feedback.comentario }}</div>
    </div>
    {% endfor %} {% else %}
    <div class="alert-info-box">
      <i class="fas fa-info-circle"></i> Ainda não deixou nenhum feedback.
      Avalie os pacotes que adquiriu!
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
