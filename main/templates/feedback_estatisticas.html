{% extends "base.html" %}
{% load static %}

{% block title %}Estatísticas de Feedbacks{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'utils.css' %}">
{% endblock %}

{% block page_title %}Estatísticas de Feedbacks{% endblock %}

{% block content %}
<div class="container_utils">

    <!-- Cabeçalho -->
    <div class="card_utils">
        <div class="voos_header_utils">
            <h1>Estatísticas de Feedbacks</h1>
            <a href="{% url 'feedbacks' %}" class="btn_search_utils">← Voltar</a>
        </div>
    </div>

    <!-- Visão Geral -->
    <div class="card_utils">
        <h2>Visão Geral</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #17a2b8;">{{ estatisticas_gerais.total_feedbacks }}</div>
                <div style="color: #6c757d; margin-top: 8px;">Total Feedbacks</div>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #17a2b8;">{{ estatisticas_gerais.media_geral }}</div>
                <div style="color: #6c757d; margin-top: 8px;">Média Geral</div>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #28a745;">{{ estatisticas_gerais.percentual_positivo }}%</div>
                <div style="color: #6c757d; margin-top: 8px;">Positivas (4-5★)</div>
            </div>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #ffc107;">{{ estatisticas_gerais.total_5_estrelas }}</div>
                <div style="color: #6c757d; margin-top: 8px;">5 Estrelas</div>
            </div>
        </div>
    </div>

    <!-- Distribuição de Avaliações -->
    <div class="card_utils">
        <h2>Distribuição de Avaliações</h2>
        <div style="margin-top: 20px;">
            {% for rating, total, percentual in distribuicao %}
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>{{ rating }} ⭐</span>
                    <span><strong>{{ total }}</strong> ({{ percentual }}%)</span>
                </div>
                <div style="background: #e9ecef; height: 25px; border-radius: 5px; overflow: hidden;">
                    <div style="background: #17a2b8; 
                                height: 100%; width: {{ percentual }}%; transition: width 0.5s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.85rem;">
                        {% if percentual > 5 %}{{ percentual }}%{% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Estatísticas por Pacote -->
    <div class="card_utils">
        <h2>Estatísticas por Pacote</h2>
        <ul class="lista_utils" style="margin-top: 20px;">
            {% for stat in estatisticas_pacotes %}
            <li>
                <div class="voo_info_utils">
                    <div class="voo_detalhes_utils">
                        <span class="voo_nome_utils">
                            {{ stat.nome_pacote }}
                        </span>
                        <span class="voo_extra_utils">
                            {{ stat.destino_nome }} | {{ stat.total_feedbacks }} feedbacks | Média: {{ stat.media_avaliacao }} ⭐
                        </span>
                    </div>
                    <div class="voo_acoes_utils">
                        <a href="{% url 'feedbacks_por_pacote' stat.pacote_id %}" class="edit_btn_utils">Ver Feedbacks</a>
                    </div>
                </div>
            </li>
            {% empty %}
            <div class="empty_state_utils">Nenhuma estatística disponível.</div>
            {% endfor %}
        </ul>
    </div>

</div>
{% endblock %}
