{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'pacote_detalhes.css' %}">

<div class="container my-5 pacote-detalhes">

  <!-- Cabeçalho do hotel -->
  <div class="pacote-header">
    <div class="pacote-info">
      <h2>{{ hotel.nome }}</h2>
      {% if hotel.endereco %}
        <p class="pacote-datas"><strong>Localização:</strong> {{ hotel.endereco }}</p>
      {% endif %}
    </div>
    <div class="pacote-preco">
      <p class="preco-label">desde</p>
      <p class="preco-valor">€{{ hotel.preco_diario }}</p>
      <p class="preco-por">por noite</p>
    </div>
  </div>

  <hr class="mt-5">

  <!-- Galeria de Imagens dos Quartos e Acomodações -->
  {% if imagens_detalhes %}
  <div class="itinerario">
    <h3>Quartos e Acomodações</h3>
    
    <!-- Carrossel de Imagens -->
    <div style="position: relative; max-width: 1200px; margin: 20px auto;">
      <!-- Container do Carrossel -->
      <div id="carrosselHotel" style="overflow: hidden; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <div id="carrosselSlides" style="display: flex; transition: transform 0.5s ease-in-out;">
          {% for imagem in imagens_detalhes %}
            <div class="carrossel-slide" style="min-width: 100%; position: relative;">
              <img src="{% url 'hotel_imagem_detalhe' hotel.hotel_id imagem.id %}" 
                   alt="{{ hotel.nome }}" 
                   style="width: 100%; height: 500px; object-fit: cover; cursor: pointer;"
                   onclick="abrirModalImagem(this.src)">
              <div style="position: absolute; bottom: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px;">
                {{ forloop.counter }} / {{ imagens_detalhes|length }}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      
      <!-- Botões de Navegação -->
      {% if imagens_detalhes|length > 1 %}
      <button onclick="moverCarrossel(-1)" 
              style="position: absolute; top: 50%; left: 20px; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 24px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 10; transition: background 0.3s;"
              onmouseover="this.style.background='white'" 
              onmouseout="this.style.background='rgba(255,255,255,0.9)'">
        &#8249;
      </button>
      <button onclick="moverCarrossel(1)" 
              style="position: absolute; top: 50%; right: 20px; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 24px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 10; transition: background 0.3s;"
              onmouseover="this.style.background='white'" 
              onmouseout="this.style.background='rgba(255,255,255,0.9)'">
        &#8250;
      </button>
      {% endif %}
      
      <!-- Indicadores (pontos) -->
      {% if imagens_detalhes|length > 1 %}
      <div style="text-align: center; margin-top: 15px;">
        {% for imagem in imagens_detalhes %}
          <span class="carrossel-indicador" 
                data-slide="{{ forloop.counter0 }}"
                onclick="irParaSlide({{ forloop.counter0 }})"
                style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; background: #ccc; margin: 0 5px; cursor: pointer; transition: background 0.3s;">
          </span>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
  
  <hr class="mt-5">
  {% endif %}

  <!-- Descrição -->
  <div class="itinerario">
    <h3>Descrição</h3>
    <div class="dia-card">
      <div class="dia-conteudo active">
        <p>{{ hotel.descricao_item|linebreaksbr }}</p>
      </div>
    </div>
  </div>

  <!-- Serviços e Notas -->
  <div class="pacote-informacoes mt-5">
    <div class="info-card">
      <button class="info-header" data-target="servicos">
        <span>Serviços e Instalações</span>
        <span class="seta">+</span>
      </button>
      <div id="servicos" class="info-conteudo">
        <p>✔️ Wi-Fi gratuito</p>
        <p>✔️ Piscina e ginásio</p>
        <p>✔️ Pequeno-almoço incluído</p>
        <p>❌ Taxas turísticas não incluídas</p>
      </div>
    </div>

    <div class="info-card">
      <button class="info-header" data-target="notas">
        <span>Notas e Condições</span>
        <span class="seta">+</span>
      </button>
      <div id="notas" class="info-conteudo">
        <ul>
          <li>Check-in: 14:00 | Check-out: 12:00</li>
          <li>Cancelamento gratuito até 48h antes da chegada</li>
          <li>Os quartos triplos são duplos com cama extra</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Botão Selecionar -->
  <div class="text-center my-5">
    {% if pacote %}
      <a href="{% url 'selecionar_hotel' hotel.hotel_id pacote.pacote_id %}" class="btn-reserva">
        Selecionar este Hotel
      </a>
    {% else %}
      <a href="#" class="btn-reserva disabled">Selecionar</a>
    {% endif %}
  </div>

</div>

<!-- Modal para visualizar imagem em tamanho grande -->
<div id="modalImagem" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); padding: 20px;">
  <span onclick="fecharModalImagem()" style="position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;">&times;</span>
  <img id="imagemModal" style="margin: auto; display: block; max-width: 90%; max-height: 90%; object-fit: contain;">
</div>

<!-- Script -->
<script>
// Controle do carrossel
let slideAtual = 0;
const totalSlides = {{ imagens_detalhes|length|default:0 }};

function atualizarCarrossel() {
  const carrosselSlides = document.getElementById('carrosselSlides');
  if (carrosselSlides) {
    carrosselSlides.style.transform = `translateX(-${slideAtual * 100}%)`;
    
    // Atualizar indicadores
    const indicadores = document.querySelectorAll('.carrossel-indicador');
    indicadores.forEach((ind, idx) => {
      ind.style.background = idx === slideAtual ? '#2c5aa0' : '#ccc';
    });
  }
}

function moverCarrossel(direcao) {
  slideAtual += direcao;
  
  // Loop infinito
  if (slideAtual < 0) {
    slideAtual = totalSlides - 1;
  } else if (slideAtual >= totalSlides) {
    slideAtual = 0;
  }
  
  atualizarCarrossel();
}

function irParaSlide(indice) {
  slideAtual = indice;
  atualizarCarrossel();
}

// Suporte para navegação por teclado
document.addEventListener('keydown', function(e) {
  if (totalSlides > 1) {
    if (e.key === 'ArrowLeft') {
      moverCarrossel(-1);
    } else if (e.key === 'ArrowRight') {
      moverCarrossel(1);
    }
  }
});

// Inicializar carrossel ao carregar
document.addEventListener('DOMContentLoaded', function() {
  atualizarCarrossel();
  
  document.querySelectorAll('.info-header').forEach(function(header) {
    header.addEventListener('click', function() {
      const targetId = header.getAttribute('data-target');
      const content = document.getElementById(targetId);
      header.classList.toggle('open');
      content.classList.toggle('active');
    });
  });
});

function abrirModalImagem(src) {
  const modal = document.getElementById('modalImagem');
  const imagemModal = document.getElementById('imagemModal');
  modal.style.display = 'block';
  imagemModal.src = src;
}

function fecharModalImagem() {
  document.getElementById('modalImagem').style.display = 'none';
}

// Fechar modal ao clicar fora da imagem
document.getElementById('modalImagem').addEventListener('click', function(e) {
  if (e.target === this) {
    fecharModalImagem();
  }
});
</script>

{% endblock %}
